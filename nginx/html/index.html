<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Department Chatbot System</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css?t=20250120-1">
    <!-- Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.11/dist/purify.min.js"></script>

    <!-- (ì„ íƒ) ì½”ë“œ í•˜ì´ë¼ì´íŠ¸ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css">
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/highlight.min.js"></script>

    <script>
    (async () => {
        try {
            const res = await fetch("/api/me", {
                credentials: "include"
            });

            const user = await res.json();

            if (!user) {
                // âŒ ë¡œê·¸ì¸ ì•ˆë¨ â†’ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ
                window.location.href = "/login.html";
            } else {
                console.log("ë¡œê·¸ì¸ ì‚¬ìš©ì:", user);
                // âœ… ë¡œê·¸ì¸ë¨ â†’ ê·¸ëŒ€ë¡œ index.html ì‚¬ìš©
            }
            // âœ… í”„ë¡œí•„ ì˜ì—­ ì±„ìš°ê¸°
            document.querySelector(".profile-name").textContent = user.name;
            document.querySelector(".profile-role").textContent = user.department;

            // âœ… ë¡œê·¸ì¸ëœ ê²½ìš°ì—ë§Œ í™”ë©´ í‘œì‹œ
            document.body.style.display = "block";

        } catch (e) {
            // ë„¤íŠ¸ì›Œí¬ / ì„œë²„ ì˜¤ë¥˜ ì‹œë„ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ
            window.location.href = "/login.html";
        }
    })();
    </script>
</head>
<body style="display: none;">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <!-- Profile Section -->
        <div class="profile-section">
            <div class="profile-header">
                <div class="profile-info">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Kim" alt="Profile" class="profile-avatar">
                    <div class="profile-details">
                        <h3 class="profile-name">Choi TaeSoo</h3>
                        <p class="profile-role">AI Development Team</p>
                    </div>
                    <span class="online-indicator"></span>
                </div>
                <button class="close-sidebar" id="closeSidebar">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- Search Bar -->
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-input" id="searchInput" placeholder="Search department...">
            </div>
        </div>

        <!-- Department Menu -->
        <nav class="department-menu">
            <!-- Administrative Section -->
            <div class="menu-section">
                <h4 class="section-title">DEPARTMENT</h4>
                <ul class="department-list">
                    <li class="department-item" data-department="marketing">
                        <i class="fas fa-bullhorn department-icon"></i>
                        <span class="department-name">Marketing</span>
                        <i class="fas fa-chevron-right arrow-icon"></i>
                    </li>
                    <li class="department-item" data-department="sales">
                        <i class="fas fa-chart-line department-icon"></i>
                        <span class="department-name">Sales</span>
                        <i class="fas fa-chevron-right arrow-icon"></i>
                    </li>
                    <li class="department-item" data-department="hr">
                        <i class="fas fa-user department-icon"></i>
                        <span class="department-name">HR</span>
                        <i class="fas fa-chevron-right arrow-icon"></i>
                    </li>
                </ul>
            </div>

            <!-- Recently -->
            <div class="menu-section">
                <h4 class="section-title">RECENTLY</h4>
                <ul class="recently-list">
                    <li class="recently-item" data-department="marketing">
                        <span class="recently-name">2025ë…„ 'ì‹ ê·œ ê³ ê° í™•ë³´'ì˜ ì—°ê°„ ìµœì¢… ìˆ˜ì¹˜ì™€ ëª©í‘œ ëŒ€ë¹„ ë‹¬ì„±ë¥ (%)ì€ ë¬´ì—‡ì¸ê°€ìš”?</span>
                    </li>
                    <li class="recently-item" data-department="marketing">
                        <span class="recently-name">2025ë…„ 'ì˜´ë‹ˆì±„ë„' ì „ëµì˜ Q3 ì§„í–‰ë¥ ê³¼ Q4 ì§„í–‰ë¥ ì˜ ì°¨ì´ë¥¼ ê³„ì‚°í•´ ì£¼ì„¸ìš”.</span>
                    </li>
                    <li class="recently-item" data-department="marketing">
                        <span class="recently-name">SNS íŒ”ë¡œì›Œê°€ 5,000ëª…ì„ ëŒíŒŒí•œ ì‹œì ì€ ëª‡ ì›”ì´ë©°, ì „ì›” ëŒ€ë¹„ ëª‡ ëª…ì´ ì¦ê°€í–ˆë‚˜ìš”?</span>
                    </li>
                    <li class="recently-item" data-department="marketing">
                        <span class="recently-name">2024ë…„ ëŒ€ë¹„ 2025ë…„ì˜ 'ì›”ê°„ ìˆœì´ìµ'ê³¼ 'ë§ˆì§„ìœ¨'ì€ ê°ê° ì–¼ë§ˆë‚˜ ê°œì„ ë˜ì—ˆëŠ”ì§€ ì•Œë ¤ ì£¼ì„¸ìš”.</span>
                    </li>       
                    <li class="recently-item" data-department="marketing">
                        <span class="recently-name">2025ë…„ ROIê°€ ë†’ì•˜ë˜ 'ì±„ë„ê°œë°œ' ì„±ê³¼ì˜ ì—°ì†ì„±ì„ ìœ„í•´ 2021ë…„ ì´í›„ ì…ì‚¬í•œ 'ìš´ì˜/ì „ëµ' ê²½ë ¥ì ëª…ë‹¨ì„ ì¶”ì¶œí•´ ì£¼ì„¸ìš”.</span>
                    </li>    
                    <li class="recently-item" data-department="hr">
                        <span class="recently-name">2026ë…„ ë§ˆì¼€íŒ…íŒ€ ì¸ì› ì¦ì›(2ëª…â†’4ëª…) ê³„íšì— ë”°ë¼, íƒ€ ë¶€ì„œì—ì„œ 'ë§ˆì¼€íŒ…' ê²½ë ¥ì„ ë³´ìœ í•œ ëŒ€ë¦¬~ê³¼ì¥ê¸‰ ì ì„ìë¥¼ ì¶”ì²œí•´ ì£¼ì„¸ìš”.</span>
                    </li>      
                    <li class="recently-item" data-department="hr">
                        <span class="recently-name">'ì˜ì—…íŒ€'ì—ì„œ 'ìš´ì˜' ê²½ë ¥ì„ ê°€ì§„ ì‚¬ì›ê³¼ ëŒ€ë¦¬ê¸‰ ì¸ì›ì€ ëˆ„êµ¬ì´ë©°, ê·¸ë“¤ì˜ ì…ì‚¬ì¼ì€ ì–¸ì œì¸ê°€ìš”?</span>
                    </li>      
                    <li class="recently-item" data-department="hr">
                        <span class="recently-name">2021ë…„ì—ì„œ 2023ë…„ ì‚¬ì´ì— ì…ì‚¬í•œ ì§ì› ì¤‘ 'ë§ˆì¼€íŒ…' ê²½ë ¥ì„ ê°€ì§„ ì‚¬ëŒë“¤ì˜ ì´ë¦„ê³¼ ì†Œì† ë¶€ì„œë¥¼ ë¦¬ìŠ¤íŠ¸ì—…í•´ ì£¼ì„¸ìš”.</span>
                    </li>      

                </ul>
            </div>
        </nav>
        <!-- Bottom Menu -->
        <div class="bottom-menu">
            <button class="menu-button">
                <i class="fas fa-cog"></i>
                <span>App Settings</span>
            </button>
            <button class="menu-button" id="btnLogout">
                <i class="fas fa-sign-out-alt"></i>
                <span>Log Out</span>
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="chat-header">
            <button class="menu-toggle" id="menuToggle">
                <i class="fas fa-bars"></i>
            </button>
            <div class="header-info">
                <span class="header-label">DEPARTMENT</span>
                <h1 class="header-title" id="departmentTitle">IT Support Team</h1>
            </div>
            <button class="settings-button">
                <i class="fas fa-cog"></i>
            </button>
        </header>

        <!-- Chat Container -->
        <div class="chat-container" id="chatContainer">
            <!-- Bot Info -->
            <div class="bot-info">
                <img src="https://api.dicebear.com/7.x/bottts/svg?seed=TechBot" alt="Tech Bot" class="bot-avatar-large">
                <h2 class="bot-name">Tech Bot</h2>
                <!-- <div class="bot-status">
                    <span class="status-indicator"></span>
                    <span class="status-text">Online â€¢ Typically replies instantly</span>
                </div> -->
            </div>

            <!-- Messages -->
            <div class="messages" id="messages">
                <div class="message-date">Today, 9:41 AM</div>
                
                <div class="message bot-message">
                    <img src="https://api.dicebear.com/7.x/bottts/svg?seed=TechBot" alt="Bot" class="message-avatar">
                    <div class="message-content">
                        <span class="message-sender">Tech Bot</span>
                        <div class="message-bubble">
                            Hello! I'm the IT Team Manager. ğŸ‘‹<br>
                            How can I assist you with your hardware or software needs today?
                        </div>
                    </div>
                </div>

                <div class="message user-message">
                    <div class="message-content">
                        <div class="message-bubble">
                            Hi! I seem to be having trouble with my VPN connection.
                        </div>
                        <span class="message-status">Read 9:42 AM</span>
                    </div>
                </div>

                <div class="message bot-message">
                    <img src="https://api.dicebear.com/7.x/bottts/svg?seed=TechBot" alt="Bot" class="message-avatar">
                    <div class="message-content">
                        <span class="message-sender">Tech Bot</span>
                        <div class="quick-actions">
                            <button class="quick-action-btn">
                                <i class="fas fa-wifi"></i>
                                Connection Issues
                            </button>
                            <button class="quick-action-btn">
                                <i class="fas fa-key"></i>
                                Reset Password
                            </button>
                            <button class="quick-action-btn">
                                <i class="fas fa-download"></i>
                                Download VPN Client
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Message Input -->
        <div class="message-input-container">
            <button class="attach-button">
                <i class="fas fa-plus"></i>
            </button>
            <!-- <button id="recordBtn" class="mic-img-btn">
                <img src="img/mic2.png" alt="Voice">
            </button> -->
            <!-- <span id="recordStatus" class="record-status"></span> -->
            <input type="text" class="message-input" id="messageInput" placeholder="Type a message...">
            <button class="send-button" id="sendButton">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </main>

    <script src="js/main.js?t=20250120-6"></script>
</body>
</html>
